#include <stdint-gcc.h>
#include <string.h>
#include "custom_hash.h"

#define ROUNDS_N 2

uint8_t SBOX[256] = {70, 90, 117, 178, 128, 155, 173, 39, 36, 16, 3, 25, 52, 32, 97, 250, 50, 154, 153, 198, 147, 195, 87, 161, 244, 201, 156, 34, 177, 22, 133, 76, 237, 143, 30, 206, 126, 47, 5, 182, 254, 179, 139, 91, 121, 236, 238, 205, 49, 246, 109, 152, 18, 241, 181, 176, 216, 56, 62, 89, 184, 220, 255, 99, 194, 129, 101, 226, 131, 0, 83, 191, 209, 55, 183, 187, 207, 145, 208, 165, 229, 130, 95, 196, 169, 23, 132, 168, 27, 240, 26, 61, 110, 164, 210, 29, 171, 1, 57, 221, 142, 14, 200, 118, 20, 217, 92, 252, 44, 67, 96, 84, 75, 215, 180, 175, 122, 81, 211, 107, 41, 115, 59, 48, 19, 218, 120, 112, 235, 149, 93, 162, 73, 219, 86, 69, 134, 35, 174, 78, 37, 223, 66, 160, 24, 197, 98, 43, 33, 203, 38, 199, 192, 111, 186, 40, 245, 108, 151, 71, 190, 100, 150, 88, 113, 72, 60, 85, 159, 82, 170, 230, 54, 212, 9, 185, 124, 253, 28, 2, 68, 225, 63, 7, 214, 10, 204, 58, 106, 188, 148, 146, 74, 4, 163, 189, 8, 224, 243, 15, 104, 119, 105, 102, 45, 53, 248, 166, 80, 103, 167, 123, 247, 127, 125, 251, 116, 249, 12, 13, 213, 138, 77, 11, 65, 114, 46, 21, 233, 234, 172, 228, 232, 31, 79, 193, 158, 136, 94, 135, 242, 157, 17, 202, 137, 140, 64, 144, 239, 6, 141, 222, 51, 227, 231, 42};

void apply_sbox(uint8_t input[8]) {
    for(uint8_t i = 0; i < 8; i++) {
        input[i] = SBOX[input[i]];
    }
}

void mul_add(uint8_t input[8]) {
    uint8_t output[8];
    for(uint8_t i = 0; i < 8; i++) {
        output[i] = input[i] ^ input[((i + 1) % 8)];
    }
    memcpy(input, output, 8);
}

void add_round_output(uint8_t input[8], uint8_t output[8]) {
    for(uint8_t i = 0; i < 8; i++) {
        output[i] ^= input[i];
    }
}

void round(uint8_t input[8], uint8_t output[8]) {
    apply_sbox(input);
    mul_add(input);
    add_round_output(input, output);
}

void process_hash(uint8_t input[8]) {
    uint8_t output[8];
    memcpy(output, input, 8);
    for(uint8_t i = 0; i < ROUNDS_N; i++) {
        round(input, output);
    }
    memcpy(input, output, 8);
}